ml_switcheroo.discovery.consensus
=================================

.. py:module:: ml_switcheroo.discovery.consensus

.. autoapi-nested-parse::

   Consensus Engine: The Dynamic Standardization Brain.

   This module implements the logic to automatically discover Abstract Standards
   by analyzing API lists from multiple frameworks. It identifies common concepts
   (e.g., "HuberLoss" in Torch vs "huber" in JAX) via fuzzy clustering and naming
   normalization, proposing them as "Candidate Standards" for the Middle Layer.

   It also performs "Signature Alignment" to determine the standard arguments
   (e.g. deciding that 'lr' is the standard argument for learning rate across frameworks).



Classes
-------

.. autoapisummary::

   ml_switcheroo.discovery.consensus.CandidateStandard
   ml_switcheroo.discovery.consensus.ConsensusEngine


Module Contents
---------------

.. py:class:: CandidateStandard(/, **data: Any)

   Bases: :py:obj:`pydantic.BaseModel`


   A proposed Abstract Standard discovered via consensus.

   Represents a single concept (e.g., 'Huber') found in one or more frameworks.

   .. attribute:: name

      The proposed Abstract Name (e.g. 'Huber').

   .. attribute:: variants

      Map of {framework_name: GhostRef} for the implementations found.

   .. attribute:: score

      A confidence score (0.0-1.0) based on how many frameworks agree.

   .. attribute:: std_args

      List of abstract argument names agreed upon by consensus.

   .. attribute:: arg_mappings

      Nested dictionary {framework_name: {std_arg: fw_arg}}.
      Used to generate the keys in the final StandardMap.


   .. py:attribute:: name
      :type:  str


   .. py:attribute:: variants
      :type:  Dict[str, ml_switcheroo.core.ghost.GhostRef]
      :value: None



   .. py:attribute:: score
      :type:  float
      :value: 0.0



   .. py:attribute:: std_args
      :type:  List[str]
      :value: None



   .. py:attribute:: arg_mappings
      :type:  Dict[str, Dict[str, str]]
      :value: None



   .. py:method:: add_variant(framework: str, ref: ml_switcheroo.core.ghost.GhostRef)

      Registers a framework's implementation of this standard.



.. py:class:: ConsensusEngine

   Algorithms for aligning divergent API naming conventions.

   Responsibility:
   1. Normalize API names (Clustering).
   2. Normalize Argument names (Signature Alignment).
   3. Compute intersection of arguments to define the Standard.


   .. py:attribute:: IGNORED_SUFFIXES
      :value: ['loss', 'error', 'layer', 'block', '2d', '1d', '3d', 'v1', 'v2', 'object']



   .. py:attribute:: ARG_ALIASES


   .. py:method:: normalize_name(name: str) -> str
      :classmethod:


      Reduces an API Name to its semantic core for comparison.



   .. py:method:: normalize_arg(arg_name: str) -> str
      :classmethod:


      Canonicalizes an argument name.
      e.g., 'learning_rate' -> 'lr'.



   .. py:method:: cluster(framework_inputs: Dict[str, List[ml_switcheroo.core.ghost.GhostRef]]) -> List[CandidateStandard]

      Groups API definitions from multiple frameworks into Candidates.



   .. py:method:: filter_common(candidates: List[CandidateStandard], min_support: int = 2) -> List[CandidateStandard]

      Returns only standards derived from agreement between multiple frameworks.



   .. py:method:: align_signatures(candidates: List[CandidateStandard], consensus_threshold: float = 0.5)

      Analyses the signatures of all variants in a candidate.
      Populates 'std_args' and 'arg_mappings' based on consensus.

      :param candidates: List of CandidateStandards to process (in-place modification).
      :param consensus_threshold: Fraction of variants that must share an arg for it to be standard.
                                  (0.5 means > 50% must have it).



