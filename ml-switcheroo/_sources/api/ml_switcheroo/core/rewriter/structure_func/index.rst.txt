ml_switcheroo.core.rewriter.structure_func
==========================================

.. py:module:: ml_switcheroo.core.rewriter.structure_func

.. autoapi-nested-parse::

   Function Structure Rewriting Logic.

   Handles transformations relative to function definitions, specifically:

   1.  **Logic 5: Method Renaming**: Mapping ``forward`` <-> ``__call__`` <-> ``call`` using Configuration Traits.
       *Decoupling Update*: Uses ``known_inference_methods`` from traits to detect candidate methods.
   2.  Signature Modification: Injecting hooks or state arguments (Logic 2).
   3.  Body Injection: Preamble handling (super init, rng splitting).
   4.  Docstring Updating.

   This class acts as an aggregator mixin, pulling specialized logic from:

   -   :class:`FuncSignatureMixin`
   -   :class:`FuncBodyMixin`
   -   :class:`FuncDocstringMixin`



Classes
-------

.. autoapisummary::

   ml_switcheroo.core.rewriter.structure_func.FuncStructureMixin


Module Contents
---------------

.. py:class:: FuncStructureMixin(semantics: ml_switcheroo.semantics.manager.SemanticsManager, config: ml_switcheroo.config.RuntimeConfig, symbol_table: Optional[ml_switcheroo.analysis.symbol_table.SymbolTable] = None)

   Bases: :py:obj:`ml_switcheroo.core.rewriter.func_signature.FuncSignatureMixin`, :py:obj:`ml_switcheroo.core.rewriter.func_body.FuncBodyMixin`, :py:obj:`ml_switcheroo.core.rewriter.func_docstring.FuncDocstringMixin`, :py:obj:`ml_switcheroo.core.rewriter.base.BaseRewriter`


   Mixin for transforming FunctionDef nodes via Traits.

   Orchestrates the granular rewriting components (Signature, Body, Docstring)
   based on the analysis of the Target Framework's traits.


   .. py:method:: visit_FunctionDef(node: libcst.FunctionDef) -> Optional[bool]

      Enters a function definition scope.

      Initializes a ``SignatureContext`` to track argument names and injection requirements.
      Determines if the function is a method of a recognized Module Class (tracked by ``ClassStructureMixin``).

      :param node: The function definition node.
      :type node: cst.FunctionDef

      :returns: True to continue visiting children.
      :rtype: Optional[bool]



   .. py:method:: leave_FunctionDef(_original_node: libcst.FunctionDef, updated_node: libcst.FunctionDef) -> libcst.CSTNode

      Exits a function definition scope and applies structural transformations.

      Applies logic based on Target Traits:

      1.  **Method Renaming**: Renames inference methods (e.g. ``forward`` -> ``__call__``).
      2.  **Constructor Ops**: Renames ``__init__`` if required (e.g. ``setup`` for Pax).
      3.  **State Injection**: Injects magic arguments (e.g. ``rngs``) if targeting Flax/JAX.
      4.  **Arg Stripping**: Removes magic arguments (e.g. ``rngs``) if targeting Torch.
      5.  **Super Init**: Injects or removes ``super().__init__()`` calls.
      6.  **Preamble**: Injects code requested by inner plugins (e.g. RNG splitting).
      7.  **Docstrings**: Updates docstrings to document injected arguments.

      :param _original_node: The original CST node (unused).
      :param updated_node: The CST node with children already visited/transformed.

      :returns: The transformed function definition.
      :rtype: cst.CSTNode



