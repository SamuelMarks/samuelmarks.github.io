ml_switcheroo.generated_tests.generator
=======================================

.. py:module:: ml_switcheroo.generated_tests.generator

.. autoapi-nested-parse::

   Dynamic Test Code Generator (Physical Synthesizer).

   This module is responsible for creating physical Python test files based on the
   Semantic Knowledge Base.

   It operations in two stages:
   1.  **Template Resolution**: It aggregates execution templates (`import`, `convert_input`, `to_numpy`)
       from the SemanticsManager, prioritizing overlays (snapshots) over registry defaults.
   2.  **Code Emission**: It iterates over Operations in the Spec, generating `def test_gen_<opname>()`
       functions that:
       - Generate random inputs using type hints.
       - Execute the operation across all available backends (Torch, JAX, etc.).
       - Compare outputs using `np.allclose`.
       - **Verify Output Shape** if `output_shape_calc` is defined in the ODL.

   JIT Logic:
       If a template specifies `jit_wrap: True` (e.g., JAX), the generator inspects the
       framework traits to identify `static_argnums` (arguments like `axis` or `keepdims`)
       and generates valid `jax.jit(fn, static_argnums=(...))` wrappers.



Classes
-------

.. autoapisummary::

   ml_switcheroo.generated_tests.generator.TestGenerator


Module Contents
---------------

.. py:class:: TestGenerator(semantics_mgr: Optional[ml_switcheroo.semantics.manager.SemanticsManager] = None)

   Generates Pytest-compatible test files from Semantic Operations.

   .. attribute:: semantics_mgr

      Source for op definitions and backend templates.

      :type: SemanticsManager

   .. attribute:: _processed_fws

      Tracks which frameworks were seen to optimize imports.

      :type: Set[str]


   .. py:attribute:: semantics_mgr


   .. py:method:: generate(semantics: Dict[str, Any], output_path: pathlib.Path) -> None

      Generates a test file containing functions for each operation in semantics.

      :param semantics: Dictionary of operations (result of mgr.get_known_apis()).
      :param output_path: Destination path for the .py file.



