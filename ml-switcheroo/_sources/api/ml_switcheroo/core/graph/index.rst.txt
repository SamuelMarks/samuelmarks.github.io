ml_switcheroo.core.graph
========================

.. py:module:: ml_switcheroo.core.graph

.. autoapi-nested-parse::

   Shared Graph Intermediate Representation.

   This module provides the language-agnostic data structures and extraction logic
   used to convert Python ASTs into a logical graph of operations (Layers) and
   data flow (Edges).

   Shared by:
   - TikZ Backend (Visualizer)
   - HTML Backend (Grid Layout)



Classes
-------

.. autoapisummary::

   ml_switcheroo.core.graph.LogicalNode
   ml_switcheroo.core.graph.LogicalEdge
   ml_switcheroo.core.graph.LogicalGraph
   ml_switcheroo.core.graph.GraphExtractor


Functions
---------

.. autoapisummary::

   ml_switcheroo.core.graph.topological_sort


Module Contents
---------------

.. py:class:: LogicalNode

   Represents a computation unit (Layer) in the graph.

   .. attribute:: id

      Unique identifier (e.g. 'conv1').

   .. attribute:: kind

      Operation type (e.g. 'Conv2d', 'Input', 'Output').

   .. attribute:: metadata

      Dictionary of configuration parameters (e.g. kernel_size=3).


   .. py:attribute:: id
      :type:  str


   .. py:attribute:: kind
      :type:  str


   .. py:attribute:: metadata
      :type:  Dict[str, str]


.. py:class:: LogicalEdge

   Represents data flow between two nodes.


   .. py:attribute:: source
      :type:  str


   .. py:attribute:: target
      :type:  str


.. py:class:: LogicalGraph

   Language-agnostic representation of the neural network structure.


   .. py:attribute:: nodes
      :type:  List[LogicalNode]
      :value: []



   .. py:attribute:: edges
      :type:  List[LogicalEdge]
      :value: []



.. py:function:: topological_sort(graph: LogicalGraph) -> List[LogicalNode]

   Sorts graph nodes by dependency order.

   :param graph: The logical graph.

   :returns: List of nodes in execution order.


.. py:class:: GraphExtractor

   Bases: :py:obj:`libcst.CSTVisitor`


   LibCST Visitor that extracts a LogicalGraph from Python source code.

   Two-Pass Logic:
   1.  **Init Pass**: Scans `__init__` or `setup` to register named layers
       assigned to `self`. Populates the node registry.
   2.  **Forward Pass**: Scans `forward` or `__call__` to trace variable usage.
       Builds edges between registered nodes based on data flow.


   .. py:attribute:: graph


   .. py:attribute:: layer_registry
      :type:  Dict[str, LogicalNode]


   .. py:attribute:: provenance
      :type:  Dict[str, str]


   .. py:attribute:: model_name
      :type:  str
      :value: 'GeneratedNet'



   .. py:method:: visit_ClassDef(node: libcst.ClassDef) -> Optional[bool]

      Capture the model class name.



   .. py:method:: leave_Module(original_node: libcst.Module) -> None

      Finalize graph construction after visiting the whole module.
      Populates the nodes list from the registry.



   .. py:method:: visit_FunctionDef(node: libcst.FunctionDef) -> Optional[bool]

      Detects entry into lifecycle methods (__init__, forward, etc).



   .. py:method:: leave_FunctionDef(node: libcst.FunctionDef) -> None

      Resets context flags upon exiting methods.



   .. py:method:: visit_Assign(node: libcst.Assign) -> Optional[bool]

      Handles assignment logic for both layer definition and data flow.



   .. py:method:: visit_Return(node: libcst.Return) -> Optional[bool]

      Handles return statements in forward pass to create Output nodes.
      Links the variable returned to an implicit 'Output' node.



