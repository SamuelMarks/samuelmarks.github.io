ml_switcheroo.core.rewriter.calls.guards
========================================

.. py:module:: ml_switcheroo.core.rewriter.calls.guards

.. autoapi-nested-parse::

   Strict Mode Guards Injection.

   This module helps inject runtime assertions for tensor properties (e.g., Rank)
   when strict mode is enabled in the compiler configuration. It ensures that
   transpiled code respects the constraints defined in the Semantic Specification.



Attributes
----------

.. autoapisummary::

   ml_switcheroo.core.rewriter.calls.guards.STRICT_RANK_HELPER


Functions
---------

.. autoapisummary::

   ml_switcheroo.core.rewriter.calls.guards.apply_strict_guards


Module Contents
---------------

.. py:data:: STRICT_RANK_HELPER
   :value: Multiline-String

   .. raw:: html

      <details><summary>Show Value</summary>

   .. code-block:: python

      """
      def _check_rank(x, rank):
          if hasattr(x, 'ndim'): n = x.ndim
          elif hasattr(x, 'shape'): n = len(x.shape)
          else: return x
          assert n == rank, f"Strict Guard: Expected rank {rank}, got {n}"
          return x
      """

   .. raw:: html

      </details>



.. py:function:: apply_strict_guards(rewriter: Any, norm_args: List[libcst.Arg], details: Dict[str, Any], target_impl: Dict[str, Any]) -> List[libcst.Arg]

   Injects runtime rank assertion wrappers around arguments if 'rank' constraint exists.

   If a standard argument has a `rank` constraint in the ODL spec, this function wraps
   the corresponding call argument with `_check_rank(val, N)`. It also handles injecting
   the helper function definition into the module preamble via the Rewriter context.

   :param rewriter: The calling Rewriter instance (InvocationMixin).
   :param norm_args: The normalized list of CST Arguments.
   :param details: The Abstract Operation definition (Hub).
   :param target_impl: The Target Framework variant definition (Spoke).

   :returns: The list of arguments, potentially wrapped with guards.
   :rtype: List[cst.Arg]


