ml_switcheroo.frameworks.base
=============================

.. py:module:: ml_switcheroo.frameworks.base

.. autoapi-nested-parse::

   Base Protocol and Registry for Framework Adapters.

   This module defines the interface that all Framework Adapters must implement.

   Key Updates (Hybrid Loading):
   - Adapters now possess an `init_mode` (LIVE or GHOST).
   - Added logic to finding and loading cached snapshots if live imports fail.
   - Expanded `collect_api` to branch between scanning live objects vs reading cached lists.



Attributes
----------

.. autoapisummary::

   ml_switcheroo.frameworks.base.SNAPSHOT_DIR


Classes
-------

.. autoapisummary::

   ml_switcheroo.frameworks.base.StandardCategory
   ml_switcheroo.frameworks.base.InitMode
   ml_switcheroo.frameworks.base.StandardMap
   ml_switcheroo.frameworks.base.FrameworkAdapter


Functions
---------

.. autoapisummary::

   ml_switcheroo.frameworks.base.load_snapshot_for_adapter
   ml_switcheroo.frameworks.base.register_framework
   ml_switcheroo.frameworks.base.get_adapter


Module Contents
---------------

.. py:data:: SNAPSHOT_DIR

.. py:class:: StandardCategory

   Bases: :py:obj:`str`, :py:obj:`enum.Enum`


   Categorization of Framework APIs for automated scanning.


   .. py:attribute:: LOSS
      :value: 'loss'



   .. py:attribute:: OPTIMIZER
      :value: 'optimizer'



   .. py:attribute:: LAYER
      :value: 'layer'



   .. py:attribute:: ACTIVATION
      :value: 'activation'



.. py:class:: InitMode

   Bases: :py:obj:`str`, :py:obj:`enum.Enum`


   Operational mode of an adapter.


   .. py:attribute:: LIVE
      :value: 'live'



   .. py:attribute:: GHOST
      :value: 'ghost'



.. py:class:: StandardMap(/, **data: Any)

   Bases: :py:obj:`pydantic.BaseModel`


   Defines how a Framework implements a Middle Layer standard.


   .. py:attribute:: api
      :type:  str
      :value: None



   .. py:attribute:: args
      :type:  Optional[Dict[str, str]]
      :value: None



   .. py:attribute:: requires_plugin
      :type:  Optional[str]
      :value: None



.. py:class:: FrameworkAdapter

   Bases: :py:obj:`Protocol`


   Protocol definition for a Framework Adapter.
   Includes Hybrid Loading Logic via Mixin-like default behavior requires careful subclassing.
   Since Protocol cannot have implementation easily without a base class,
   we define the Interface here and provide a helper method for loading snapshots.


   .. py:method:: convert(data: Any) -> Any

      Converts input data (usually array-like) to this framework's tensor type.



   .. py:property:: search_modules
      :type: List[str]


      List of python modules to scan when running `ml_switcheroo sync`.


   .. py:property:: display_name
      :type: str


      Friendly name for UI/CLI (e.g. 'PyTorch').


   .. py:property:: ui_priority
      :type: int


      Integer defining the sort order in UI tables and Dropdowns.


   .. py:property:: discovery_heuristics
      :type: Dict[str, List[str]]


      Regex patterns used to categorize API surfaces.


   .. py:property:: import_alias
      :type: Tuple[str, str]


      Default module import path and alias.


   .. py:property:: inherits_from
      :type: Optional[str]


      Key of a parent framework to inherit mappings from.


   .. py:property:: structural_traits
      :type: ml_switcheroo.semantics.schema.StructuralTraits


      Defines how Classes and Functions should be transformed.


   .. py:property:: rng_seed_methods
      :type: List[str]


      Returns a list of method names that modify global random state.


   .. py:method:: get_device_syntax(device_type: str, device_index: Optional[str] = None) -> str

      Returns Python source code to instantiate a device on this backend.



   .. py:method:: get_serialization_syntax(op: str, file_arg: str, object_arg: Optional[str] = None) -> str

      Returns Python source code to perform IO operations.



   .. py:method:: get_serialization_imports() -> List[str]

      Returns a list of import statements required for serialization to work.



   .. py:method:: get_example_code() -> str
      :classmethod:


      Returns a Python code snippet demonstrating a typical operation.



   .. py:property:: definitions
      :type: Dict[str, StandardMap]


      Returns the framework's implementation of Middle Layer Operations.


   .. py:method:: collect_api(category: StandardCategory) -> List[ml_switcheroo.core.ghost.GhostRef]

      Scans the installed framework (LIVE) or reads from snapshot (GHOST).

      :param category: The semantic category to scan for.

      :returns: A list of GhostRef objects representing the discovered API surface.



.. py:function:: load_snapshot_for_adapter(fw_key: str) -> Dict[str, Any]

   Locates the most recent snapshot for a given framework key (e.g. 'torch').
   Used by Adapter __init__ methods when entering Ghost Mode.

   :returns: The snapshot data dictionary (containing 'categories', 'version', etc).
             Returns empty dict if no snapshot found.


.. py:function:: register_framework(name: str)

   Decorator to register a framework adapter class.


.. py:function:: get_adapter(name: str) -> Optional[FrameworkAdapter]

   Factory to instantiate an adapter.


