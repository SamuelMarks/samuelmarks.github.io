ml_switcheroo.testing.fuzzer
============================

.. py:module:: ml_switcheroo.testing.fuzzer

.. autoapi-nested-parse::

   Input Generation Engine for Semantics Verification.

   This module provides the `InputFuzzer`, responsible for creating randomized
   NumPy arrays, scalars, and complex container structures to feed into Framework A
   and Framework B during behavioral verification tests.

   ## Generation Strategies

   It uses a dual-strategy approach:

   1.  **Type Hints (Semantic Validated)**:
       If `spec_reader` has extracted explicit type information from the spec files,
       the fuzzer parses these strings using a mini-grammar to generate compliant data.

       **Supported Grammar:**
       - Primitives: `int`, `float`, `bool`, `str`
       - Structural: `List[T]`, `Tuple[T, ...]`, `Dict[K, V]`, `Optional[T]`
       - Unions: `int | float`
       - Domain: `Array`, `Tensor`, `dtype`
       - **Symbolic Shapes (New)**: `Array['B', 'N']` (Constraint Solving)

   2.  **Heuristics (Fallback)**:
       If no hints are available in the spec, it infers data types from argument names.
       - `mask`, `condition` -> `bool`
       - `idx`, `axis`, `dim` -> `int`
       - `x`, `y`, `input` -> `Array (float32)`

   ## Safety

   The fuzzer implements `MAX_RECURSION_DEPTH` to prevent infinite loops when generating
   recursive or deeply nested types (e.g. `List[List[List[...]]]`).



Classes
-------

.. autoapisummary::

   ml_switcheroo.testing.fuzzer.InputFuzzer


Module Contents
---------------

.. py:class:: InputFuzzer(seed_shape: Optional[Tuple[int, Ellipsis]] = None)

   Generates dummy inputs (Arrays, Scalars, Containers) for equivalence testing.

   Prioritizes explicit Type Hints from the Knowledge Base. Falls back to
   name-based heuristics if hints are missing or ambiguous (e.g., 'Any').

   .. attribute:: _seed_shape

      If set, forces generation
      of arrays with this specific shape.

      :type: Optional[Tuple[int, ...]]

   .. attribute:: max_depth

      Maximum recursion depth for nested container types.

      :type: int


   .. py:attribute:: MAX_RECURSION_DEPTH
      :value: 3



   .. py:attribute:: max_depth
      :value: 3



   .. py:method:: generate_inputs(params: List[str], hints: Optional[Dict[str, str]] = None) -> Dict[str, Any]

      Creates a dictionary of {arg_name: value}.

      :param params: List of argument names [x, y, axis].
      :param hints: Dictionary of {arg_name: type_string} derived from Spec.
                    Example: {"x": "Array['B', 'T']", "axis": "int"}.

      :returns: Randomized inputs ready for Framework adaptation.
      :rtype: Dict[str, Any]



   .. py:method:: adapt_to_framework(kwargs: Dict[str, Any], framework: str) -> Dict[str, Any]

      Converts Numpy inputs to framework-specific tensor types.
      Delegates to registered adapters in `ml_switcheroo.testing.adapters`.

      :param kwargs: Input dictionary with Numpy values.
      :param framework: "torch", "jax", "tensorflow", etc.

      :returns: Dict with framework-specific tensors.



