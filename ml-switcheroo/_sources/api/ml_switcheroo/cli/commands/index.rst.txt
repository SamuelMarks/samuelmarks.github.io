ml_switcheroo.cli.commands
==========================

.. py:module:: ml_switcheroo.cli.commands

.. autoapi-nested-parse::

   CLI Command Handlers Facade.

   This module primarily re-exports handlers from `ml_switcheroo.cli.handlers`
   to maintain backward compatibility with existing tests and imports. Must remain
   synced with handler modules.



Functions
---------

.. autoapisummary::

   ml_switcheroo.cli.commands.handle_audit
   ml_switcheroo.cli.commands.handle_convert
   ml_switcheroo.cli.commands.handle_scaffold
   ml_switcheroo.cli.commands.handle_import_spec
   ml_switcheroo.cli.commands.handle_sync_standards
   ml_switcheroo.cli.commands.handle_snapshot
   ml_switcheroo.cli.commands.handle_sync
   ml_switcheroo.cli.commands.handle_wizard
   ml_switcheroo.cli.commands.handle_harvest
   ml_switcheroo.cli.commands.handle_ci
   ml_switcheroo.cli.commands.handle_matrix
   ml_switcheroo.cli.commands.handle_docs
   ml_switcheroo.cli.commands.handle_gen_tests
   ml_switcheroo.cli.commands.resolve_semantics_dir
   ml_switcheroo.cli.commands.resolve_snapshots_dir
   ml_switcheroo.cli.commands.handle_gen_weight_script


Module Contents
---------------

.. py:function:: handle_audit(path: pathlib.Path, source_frameworks: List[str], json_mode: bool = False) -> int

   Scans a directory/file to determine coverage against the Knowledge Base.

   :param path: Input source file or directory.
   :param source_frameworks: List of framework keys to scan for.
   :param json_mode: If True, output JSON to stdout and suppress Rich logs.

   :returns:

             Exit code (0 if audit reveals full coverage, 1 if missing ops).
                  Note: In audit mode, missing ops might be considered a 'failure'.
   :rtype: int


.. py:function:: handle_convert(input_path: pathlib.Path, output_path: Optional[pathlib.Path], source: Optional[str], target: Optional[str], verify: bool, strict: Optional[bool], intermediate: Optional[str], plugin_settings: Dict[str, Any], json_trace_path: Optional[pathlib.Path] = None) -> int

   Handles the 'convert' command execution.

   Orchestrates the loading of configuration, initialization of the semantic
   knowledge base, and the execution of the transpilation engine on files or directories.

   :param input_path: Path to the source file or directory to convert.
   :param output_path: Path where generated code should be saved.
   :param source: Override for source framework (e.g. 'torch').
   :param target: Override for target framework (e.g. 'jax').
   :param verify: If True, generates and runs a verification harness test immediately.
   :param strict: If True, enforces strict strict_mode on the Engine.
   :param intermediate: If provided, forces a roundtrip via this IR (e.g. 'mlir').
   :param plugin_settings: Dictionary of specific plugin configuration flags.
   :param json_trace_path: Optional path to dump execution trace JSON.

   :returns: Exit code (0 for success, 1 for failure).
   :rtype: int


.. py:function:: handle_scaffold(frameworks: list[str], out_dir: pathlib.Path) -> int

   Handles the 'scaffold' command.

   -   Iterates through provided frameworks.
   -   Uses `FrameworkAdapter.discovery_heuristics` regexes to fuzzy match framework
       APIs against known specs or structural conventions.
   -   Populates semantic specs (Hub) and framework mappings (Spokes/Snapshots).

   :param frameworks: List of framework package names to scaffold (e.g., ['torch', 'jax']).
   :type frameworks: list[str]
   :param out_dir: The root directory for generating the knowledge base.
                   Defaults to the package source if None.
   :type out_dir: Path

   :returns: Exit code.
   :rtype: int


.. py:function:: handle_import_spec(target: pathlib.Path) -> int

   Handles the 'import-spec' command.

   Parses upstream standards documentation or stubs and merges the definitions
   into the local semantics Hub.

   :param target: Code resource to import ('internal', .md file, .html file, or directory).
   :type target: Path

   :returns: Exit code.
   :rtype: int


.. py:function:: handle_sync_standards(categories: List[str], frameworks: Optional[List[str]], dry_run: bool) -> int

   Handles 'sync-standards' command.

   Invokes the Consensus Engine to automatically discover new Abstract Operations
   by finding commonalities across multiple framework API surfaces. Writes the
   results to `k_discovered.json` (The Unofficial/Discovered Standard).

   :param categories: List of category strings (layer, loss, etc.) to scan.
   :type categories: List[str]
   :param frameworks: List of framework keys to scan.
                      Defaults to installed/registered frameworks.
   :type frameworks: Optional[List[str]]
   :param dry_run: If True, prints results without saving.
   :type dry_run: bool

   :returns: Exit code.
   :rtype: int


.. py:function:: handle_snapshot(out_dir: Optional[pathlib.Path]) -> int

   Handles the 'snapshot' command.

   Scans installed frameworks and dumps their API signatures to JSON files.
   These snapshots allow the engine to operate in "Ghost Mode" (e.g., in WebAssembly)
   without requiring the heavy frameworks to be installed.

   :param out_dir: Optional custom output directory. Defaults to package/snapshots.

   :returns: Exit code (0 for success, 1 for failure).


.. py:function:: handle_sync(framework: str) -> int

   Handles the 'sync' command.

   Links the Abstract Standards (Hub) to the concrete implementation in a
   specific framework. This process involves:
   1.  Reading the Specs from ``semantics/``.
   2.  Introspecting the installed framework to find matching APIs.
   3.  **Merging Static Definitions** from the Adapter (for Ghost support).
   4.  Applying Adapter-specific manual wiring (plugins, templates).
   5.  **Persisting Test Configuration templates**.
   6.  Writing the results to the Snapshot Overlay (``snapshots/{fw}_mappings.json``).

   :param framework: The framework key to sync (e.g. 'torch', 'jax').

   :returns: Exit code (0 for success, 1 for failure).


.. py:function:: handle_wizard(package: str) -> int

   Handles the 'wizard' command for interactive mapping discovery.

   :param package: The name of the python package to inspect (e.g., 'torch').

   :returns: Exit code (0 for success).
   :rtype: int


.. py:function:: handle_harvest(path: pathlib.Path, target: str, dry_run: bool) -> int

   Handles the 'harvest' command to learn mappings from manual tests.

   :param path: File or directory containing python test files.
   :param target: The framework target used in the tests (e.g., 'jax').
   :param dry_run: If True, prints changes without writing to disk.

   :returns: Exit code (0 for success, 1 for path errors).
   :rtype: int


.. py:function:: handle_ci(update_readme: bool, readme_path: pathlib.Path, json_report: Optional[pathlib.Path]) -> int

   Handles 'ci' command.


.. py:function:: handle_matrix() -> int

   Handles 'matrix' command.
   Prints the compatibility table to stdout.

   :returns: 0 on success.
   :rtype: int


.. py:function:: handle_docs(source: str, target: str, out_path: pathlib.Path) -> int

   Handles 'gen-docs' command.
   Generates a migration guide Markdown file.

   :param source: Source framework key.
   :param target: Target framework key.
   :param out_path: Output file path.

   :returns: 0 on success.
   :rtype: int


.. py:function:: handle_gen_tests(out: pathlib.Path) -> int

   Handles 'gen-tests' command.
   Generates physical test files for known APIs.

   :param out: Output file path.

   :returns: 0 on success.
   :rtype: int


.. py:function:: resolve_semantics_dir() -> pathlib.Path

   Locates the directory containing semantic JSON definitions.

   Prioritizes the local file system (relative to this file) to ensure
   tests and editable installs find the source of truth correctly.
   Falls back to package resources for installed distributions.

   :returns: The absolute path to the 'semantics' directory.
   :rtype: Path


.. py:function:: resolve_snapshots_dir() -> pathlib.Path

   Locates the directory containing framework snapshots and mapping overlays.
   Defaults to the sibling 'snapshots' directory relative to 'semantics'.

   :returns: The absolute path to the 'snapshots' directory.
   :rtype: Path


.. py:function:: handle_gen_weight_script(source_file: pathlib.Path, out_script: pathlib.Path, source_fw: Optional[str] = None, target_fw: Optional[str] = None) -> int

   Handler for generating weight migration script.

   Delegates to the `WeightScriptGenerator` class.

   :param source_file: Path to the model source code.
   :param out_script: Path to write the output script.
   :param source_fw: Source framework key (optional).
   :param target_fw: Target framework key (optional).

   :returns: Exit Code (0 for success, 1 for failure).
   :rtype: int


