ml_switcheroo.frameworks.mlx
============================

.. py:module:: ml_switcheroo.frameworks.mlx

.. autoapi-nested-parse::

   Apple MLX Framework Adapter.

   This module provides the adapter for Apple's MLX array framework.
   It supports:
   1.  **Unified Memory math**: Mapping ``mlx.core`` operations.
   2.  **Neural Networks**: Mapping ``mlx.nn`` layers and containers.
   3.  **Discovery**: Runtime introspection of the MLX API surface.
   4.  **Types**: Mapping Abstract Types to ``mlx.core`` dtypes (e.g. ``mx.float32``).
   5.  **Casting**: Generic casting plugin integration via ``.astype()``.
   6.  **Weight Migration**: Loading/saving .npz or .safetensors files (via stubs/core).

   Definitions are loaded from `frameworks/definitions/mlx.json`.



Classes
-------

.. autoapisummary::

   ml_switcheroo.frameworks.mlx.MLXAdapter


Module Contents
---------------

.. py:class:: MLXAdapter

   Adapter for Apple MLX (Silicon-optimized tensor framework).


   .. py:attribute:: display_name
      :type:  str
      :value: 'Apple MLX'



   .. py:attribute:: inherits_from
      :type:  Optional[str]
      :value: None



   .. py:attribute:: ui_priority
      :type:  int
      :value: 50



   .. py:property:: search_modules
      :type: List[str]


      Returns list of MLX submodules to scan during discovery.

      :returns: Module list.
      :rtype: List[str]


   .. py:property:: unsafe_submodules
      :type: Set[str]


      Submodules safe to avoid during recursion.

      :returns: Default empty set.
      :rtype: Set[str]


   .. py:property:: import_alias
      :type: Tuple[str, str]


      ``import mlx.core as mx``.

      :returns: ("mlx.core", "mx").
      :rtype: Tuple[str, str]

      :type: Default alias for core array operations


   .. py:property:: import_namespaces
      :type: Dict[str, ml_switcheroo.frameworks.base.ImportConfig]


      Self-declaration of namespaces.

      :returns: Namespace map.
      :rtype: Dict[str, ImportConfig]


   .. py:property:: discovery_heuristics
      :type: Dict[str, List[str]]


      Regex patterns for categorizing discovered APIs into Tiers.

      :returns: Heuristics map.
      :rtype: Dict[str, List[str]]


   .. py:property:: test_config
      :type: Dict[str, str]


      Templates for generating physical verification tests.

      :returns: Templates.
      :rtype: Dict[str, str]


   .. py:property:: harness_imports
      :type: List[str]


      Imports for harness.

      :returns: Empty list.
      :rtype: List[str]


   .. py:method:: get_harness_init_code() -> str

      Initialization code.

      :returns: Empty string.
      :rtype: str



   .. py:method:: get_to_numpy_code() -> str

      Returns code to convert MLX arrays (which have .tolist()) to NumPy.

      :returns: Python logic for conversion.
      :rtype: str



   .. py:property:: supported_tiers
      :type: List[ml_switcheroo.enums.SemanticTier]


      Returns supported semantic tiers (Array, Neural, Extras).

      :returns: Supported Tiers.
      :rtype: List[SemanticTier]


   .. py:property:: declared_magic_args
      :type: List[str]


      Implicit RNG arguments.

      :returns: Empty.
      :rtype: List[str]


   .. py:property:: structural_traits
      :type: ml_switcheroo.frameworks.base.StructuralTraits


      Defines structural rewriting rules (Classes, Methods, Init).

      Updated to strip 'rngs' argument coming from Flax NNX, as MLX
      handles initialization statefully/eagerly.

      :returns: Config object.
      :rtype: StructuralTraits


   .. py:property:: plugin_traits
      :type: ml_switcheroo.frameworks.base.PluginTraits


      Plugin behavior configuration.

      :returns: Config object.
      :rtype: PluginTraits


   .. py:property:: definitions
      :type: Dict[str, ml_switcheroo.frameworks.base.StandardMap]


      Static definitions for MLX mappings.
      Loaded dynamically from `frameworks/definitions/mlx.json`.

      :returns: Definitions map.
      :rtype: Dict[str, StandardMap]


   .. py:property:: rng_seed_methods
      :type: List[str]


      Returns list of global seed setters.

      :returns: Method names.
      :rtype: List[str]


   .. py:method:: collect_api(category: ml_switcheroo.frameworks.base.StandardCategory) -> List[ml_switcheroo.core.ghost.GhostRef]

      Performs runtime introspection to discover available MLX APIs.

      :param category: Category to scan.
      :type category: StandardCategory

      :returns: Found items.
      :rtype: List[GhostRef]



   .. py:method:: convert(data: Any) -> Any

      Converts input data (NumPy/List) to MLX Tensor for verification.

      :param data: Input.
      :type data: Any

      :returns: MLX Array or original.
      :rtype: Any



   .. py:method:: get_example_code() -> str
      :classmethod:


      Returns default example.

      :returns: Code.
      :rtype: str



   .. py:method:: get_tiered_examples() -> Dict[str, str]

      Returns MLX idiomatic examples used for validity testing.

      :returns: Example maps.
      :rtype: Dict[str, str]



   .. py:method:: get_device_syntax(device_type: str, device_index: Optional[str] = None) -> str

      Returns device constructor syntax.

      :param device_type: Device description.
      :param device_index: Device index.

      :returns: Generated code.
      :rtype: str



   .. py:method:: get_device_check_syntax() -> str

      Check if default device is GPU.
      Note: MLX Unified Memory doesn't have strict 'is_available' but we check backend.

      :returns: Code string.
      :rtype: str



   .. py:method:: get_rng_split_syntax(rng_var: str, key_var: str) -> str

      MLX usually uses implicit state, but if explicit mode is requested,
      return 'pass' as split logic differs significantly.

      :returns: "pass".
      :rtype: str



   .. py:method:: get_serialization_imports() -> List[str]

      Returns imports for serialization.

      :returns: Imports.
      :rtype: List[str]



   .. py:method:: get_serialization_syntax(op: str, file_arg: str, object_arg: Optional[str] = None) -> str

      Returns save/load syntax.

      :param op: 'save' or 'load'.
      :param file_arg: Target file path.
      :param object_arg: Object name.

      :returns: Code string.
      :rtype: str



   .. py:method:: get_weight_conversion_imports() -> List[str]

      Returns imports needed for weight scripts.



   .. py:method:: get_weight_load_code(path_var: str) -> str

      Loads weights using mx.load (npz/safetensors) into a raw dictionary.



   .. py:method:: get_tensor_to_numpy_expr(tensor_var: str) -> str

      Converts MLX array to numpy.



   .. py:method:: get_weight_save_code(state_var: str, path_var: str) -> str

      Saves dictionary of arrays to .npz or .safetensors.



   .. py:method:: apply_wiring(snapshot: Dict[str, Any]) -> None

      Applies manual wiring for MLX.
      Overrides/Patches snapshot items that cannot be statically defined.

      :param snapshot: Snapshotdict.



   .. py:method:: get_doc_url(api_name: str) -> Optional[str]

      Generates documentation URL for MLX APIs using autosummary pattern.

      :param api_name: Fully qualified API string.

      :returns: URL.
      :rtype: Optional[str]



