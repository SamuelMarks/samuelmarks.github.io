ml_switcheroo.core.rewriter.calls.pre
=====================================

.. py:module:: ml_switcheroo.core.rewriter.calls.pre

.. autoapi-nested-parse::

   Pre-processing Phase for Call Rewriting.

   Handles logic that must occur before the core semantic lookup:

   1.  **Functional Unwrapping**: Converting ``apply`` patterns if converting from functional frameworks.
   2.  **Plugin Claims**: Heuristic execution of plugins (like in-place unrolling).
   3.  **Lifecycle Management**: Stripping methods like ``.cuda()`` or ``.eval()``.
   4.  **Stateful Calls**: Rewriting calls that require state injection.
   5.  **Implicit Resolution**: Guessing API paths for method calls on objects, using
       Symbol Table inference or heuristic fallbacks.



Functions
---------

.. autoapisummary::

   ml_switcheroo.core.rewriter.calls.pre.handle_pre_checks
   ml_switcheroo.core.rewriter.calls.pre.resolve_implicit_method


Module Contents
---------------

.. py:function:: handle_pre_checks(rewriter: Any, original: libcst.Call, updated: libcst.Call, func_name: Optional[str]) -> Tuple[bool, libcst.CSTNode]

   Executes pre-lookup checks and transformations.

   These checks handle framework-specific idioms that don't map cleanly via
   simple API renaming (e.g., in-place operations, lifecycle management,
   functional state patterns).

   :param rewriter: The parent Rewriter instance containing context and config.
   :param original: The original CST node (before traversal).
   :param updated: The updated CST node (after children handling).
   :param func_name: The resolved fully qualified name of the function, or None if unresolved.

   :returns: A tuple containing:

             -   ``handled (bool)``: If True, the transformation is complete and should return early.
             -   ``node (cst.CSTNode)``: The result node (or updated node if not handled).
   :rtype: Tuple[bool, cst.CSTNode]


.. py:function:: resolve_implicit_method(rewriter: Any, original: libcst.Call, func_name: Optional[str]) -> Optional[str]

   Attempts to resolve method calls on objects to full API paths.

   .. rubric:: Example

   ``x.view()`` -> ``torch.Tensor.view``

   Logic:

   1.  **Type Inference**: Consults the Symbol Table (if available) to determine
       the type of the receiver object (e.g., it is a Tensor).
   2.  **Heuristic Fallback**: Checks implicit root classes (e.g. ``torch.Tensor``)
       defined in the source traits to guess if the method belongs to them.

   :param rewriter: The calling rewriter instance.
   :param original: The original CST node structure.
   :param func_name: The currently resolved name (usually None or the failed name).

   :returns: Resolved fully qualified name, or None if no match found.
   :rtype: Optional[str]


